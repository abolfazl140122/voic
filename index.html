<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مغز شو</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.08) 0%, transparent 30%),
                radial-gradient(circle at 90% 80%, rgba(255, 215, 0, 0.08) 0%, transparent 30%);
        }
        
        .gold-text {
            color: #FFD700;
        }
        
        .gold-border {
            border-color: #FFD700;
        }
        
        .gold-bg {
            background-color: #FFD700;
        }
        
        .btn {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 2px solid #FFD700;
            color: #FFD700;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .btn:hover {
            background: linear-gradient(145deg, #FFD700, #FFC000);
            color: #121212;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn-small {
            font-size: 0.85rem;
            padding: 0.5rem 0.75rem;
        }
        
        .puzzle-card {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 2px solid #FFD700;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .option {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 2px solid #555;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            border-color: #FFD700;
            transform: translateY(-2px);
        }
        
        .option.selected {
            border-color: #FFD700;
            background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
        }
        
        .option.correct {
            border-color: #4CAF50;
            background: linear-gradient(145deg, #1a1a1a, #2a6a2a);
        }
        
        .option.wrong {
            border-color: #F44336;
            background: linear-gradient(145deg, #1a1a1a, #6a2a2a);
        }
        
        .logo-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .glow {
            text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700;
        }
        
        .creator-glow {
            animation: creatorGlow 2s infinite;
        }
        
        @keyframes creatorGlow {
            0% { text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
            50% { text-shadow: 0 0 15px #FF5722, 0 0 30px #FF5722; }
            100% { text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
        }
        
        .vip-glow {
            animation: vipGlow 2s infinite;
        }
        
        @keyframes vipGlow {
            0% { text-shadow: 0 0 10px #9C27B0, 0 0 20px #9C27B0; }
            50% { text-shadow: 0 0 15px #673AB7, 0 0 30px #673AB7; }
            100% { text-shadow: 0 0 10px #9C27B0, 0 0 20px #9C27B0; }
        }
        
        .word-piece {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s;
        }
        
        .word-piece:hover {
            border-color: #FFD700;
        }
        
        .word-piece.selected {
            border-color: #FFD700;
            background: #3a3a3a;
        }
        
        .word-container {
            min-height: 60px;
            background: rgba(255,255,255,0.05);
            border: 2px dashed #555;
            border-radius: 8px;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #FFD700;
            opacity: 0;
        }
        
        .profile-box {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 2px solid #FFD700;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .profile-avatar {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .settings-icon {
            transition: transform 0.3s ease;
        }
        
        .settings-icon:hover {
            transform: rotate(90deg);
        }
        
        .badge {
            background: linear-gradient(145deg, #FFD700, #FFC000);
            color: #121212;
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 1rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .menu-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .trophy-icon {
            color: #FFD700;
            filter: drop-shadow(0 0 3px rgba(255, 215, 0, 0.5));
        }
        
        .coin-icon {
            color: #FFC107;
            filter: drop-shadow(0 0 3px rgba(255, 193, 7, 0.5));
        }
        
        .creator-badge {
            background: linear-gradient(145deg, #FF5722, #FF9800);
            animation: badgePulse 2s infinite;
        }
        
        .vip-badge {
            background: linear-gradient(145deg, #9C27B0, #673AB7);
            animation: badgePulse 2s infinite;
        }
        
        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .creator-bg {
            background: linear-gradient(to bottom right, #1a1a1a, #2a2a2a), 
                        radial-gradient(circle at top left, rgba(255, 87, 34, 0.2), transparent 70%),
                        radial-gradient(circle at bottom right, rgba(255, 152, 0, 0.2), transparent 70%);
        }
        
        .vip-bg {
            background: linear-gradient(to bottom right, #1a1a1a, #2a2a2a),
                        radial-gradient(circle at top left, rgba(156, 39, 176, 0.2), transparent 70%),
                        radial-gradient(circle at bottom right, rgba(103, 58, 183, 0.2), transparent 70%);
        }
        
        .hint-button {
            background: linear-gradient(145deg, #9C27B0, #673AB7);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .hint-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .skip-button {
            background: linear-gradient(145deg, #FF5722, #FF9800);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .skip-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .edit-button {
            background: linear-gradient(145deg, #FF5722, #FF9800);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .edit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .creator-confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-image: linear-gradient(145deg, #FF5722, #FF9800);
            opacity: 0;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .vip-confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-image: linear-gradient(145deg, #9C27B0, #673AB7);
            opacity: 0;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .shop-item {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 2px solid #555;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .shop-item:hover {
            border-color: #FFD700;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .shop-item.selected {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .avatar-preview {
            width: 60px;
            height: 60px;
            border-radius: 0.5rem;
            margin: 0 auto;
            margin-bottom: 0.5rem;
        }
        
        .avatar-black-gold {
            background: linear-gradient(135deg, #000000 50%, #FFD700 50%);
        }
        
        .avatar-black-red {
            background: linear-gradient(135deg, #000000 50%, #F44336 50%);
        }
        
        .avatar-red-gold {
            background: linear-gradient(135deg, #F44336 50%, #FFD700 50%);
        }
        
        .avatar-purple-gold {
            background: linear-gradient(135deg, #9C27B0 50%, #FFD700 50%);
        }
        
        .avatar-blue-gold {
            background: linear-gradient(135deg, #2196F3 50%, #FFD700 50%);
        }
        
        .avatar-green-gold {
            background: linear-gradient(135deg, #4CAF50 50%, #FFD700 50%);
        }
        
        .avatar-rainbow {
            background: linear-gradient(to right, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF, #4B0082, #9400D3);
        }
        
        .avatar-creator {
            background: linear-gradient(135deg, #FF5722 50%, #FFD700 50%);
            box-shadow: 0 0 15px rgba(255, 87, 34, 0.5);
            animation: creatorAvatarGlow 2s infinite;
        }
        
        @keyframes creatorAvatarGlow {
            0% { box-shadow: 0 0 10px rgba(255, 87, 34, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.7); }
            100% { box-shadow: 0 0 10px rgba(255, 87, 34, 0.5); }
        }
        
        .avatar-vip {
            background: linear-gradient(135deg, #9C27B0 50%, #673AB7 50%);
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
            animation: vipAvatarGlow 2s infinite;
        }
        
        @keyframes vipAvatarGlow {
            0% { box-shadow: 0 0 10px rgba(156, 39, 176, 0.5); }
            50% { box-shadow: 0 0 20px rgba(103, 58, 183, 0.7); }
            100% { box-shadow: 0 0 10px rgba(156, 39, 176, 0.5); }
        }
        
        .timer-bar {
            height: 6px;
            background: linear-gradient(to right, #FFD700, #FF5722);
            border-radius: 3px;
            transition: width 1s linear;
        }
        
        .math-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .math-cell {
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 0.25rem;
            padding: 0.5rem;
            text-align: center;
            font-weight: bold;
        }
        
        .sequence-container {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .sequence-box {
            width: 40px;
            height: 40px;
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .sequence-box.empty {
            border: 1px dashed #555;
            background: rgba(255,255,255,0.05);
        }
        
        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 1rem;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        .difficulty-easy {
            background: linear-gradient(145deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .difficulty-medium {
            background: linear-gradient(145deg, #FF9800, #FFC107);
            color: #121212;
        }
        
        .difficulty-hard {
            background: linear-gradient(145deg, #F44336, #FF5722);
            color: white;
        }
        
        .difficulty-expert {
            background: linear-gradient(145deg, #9C27B0, #673AB7);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-black z-50">
        <div class="text-center">
            <h1 class="text-4xl font-bold gold-text mb-4 glow">استدیو اسکورت گیم</h1>
            <p class="text-xl text-gray-300">تقدیم می‌کند</p>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-black z-40 hidden">
        <div class="logo-animation mb-8">
            <svg width="100" height="100" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="none" stroke="#FFD700" stroke-width="5" />
                <path d="M30,50 Q50,20 70,50 T30,50" fill="none" stroke="#FFD700" stroke-width="5" />
                <circle cx="40" cy="40" r="5" fill="#FFD700">
                    <animate attributeName="cx" values="40;60;40" dur="3s" repeatCount="indefinite" />
                </circle>
            </svg>
        </div>
        <h1 class="text-4xl font-bold gold-text mb-4 glow">مغز شو</h1>
        <div class="w-64 h-2 bg-gray-800 rounded-full overflow-hidden">
            <div id="loading-bar" class="h-full gold-bg" style="width: 0%"></div>
        </div>
        <p id="loading-text" class="mt-2 text-gray-400">در حال بارگذاری... 0%</p>
    </div>

    <!-- Registration Screen -->
    <div id="registration-screen" class="fixed inset-0 flex items-center justify-center bg-black z-30 hidden">
        <div class="puzzle-card p-8 rounded-lg w-11/12 max-w-md slide-in">
            <h2 class="text-3xl font-bold gold-text text-center mb-6">ثبت نام</h2>
            <form id="registration-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium mb-1">نام کاربری</label>
                    <input type="text" id="username" class="w-full px-4 py-3 bg-gray-900 border gold-border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                </div>
                <button type="submit" class="w-full btn py-3 px-4 rounded-lg text-lg font-bold">ورود به بازی</button>
            </form>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="fixed inset-0 bg-black z-20 hidden">
        <div class="container mx-auto px-4 py-6 h-full flex flex-col">
            <!-- Header with settings -->
            <div class="flex items-center justify-between mb-4">
                <div></div> <!-- Empty div for flex spacing -->
                <button id="settings-button" class="settings-icon p-2 rounded-full bg-gray-900 gold-border">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
            
            <!-- Profile Box -->
            <div class="flex justify-center mb-8">
                <div class="profile-box p-4 rounded-lg flex items-center space-x-4 rtl:space-x-reverse">
                    <div class="flex flex-col items-end">
                        <div class="flex items-center mb-1">
                            <span class="trophy-icon mr-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                </svg>
                            </span>
                            <span id="player-trophies" class="text-sm font-bold gold-text">0</span>
                        </div>
                        <div class="flex items-center">
                            <span class="coin-icon mr-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </span>
                            <span id="player-coins" class="text-sm font-bold text-yellow-400">100</span>
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <div id="player-avatar" class="profile-avatar w-16 h-16 rounded-lg mb-1 avatar-black-gold"></div>
                        <span id="player-name" class="gold-text font-bold text-sm">بازیکن</span>
                        <div id="player-badges" class="flex mt-1 space-x-1 rtl:space-x-reverse">
                            <!-- Badges will be added here dynamically -->
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-start">
                        <div class="flex items-center mb-1">
                            <span id="player-level" class="text-sm font-bold gold-text">سطح 1</span>
                        </div>
                        <div class="w-16 h-2 bg-gray-800 rounded-full overflow-hidden">
                            <div id="player-xp-bar" class="h-full gold-bg" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Game Logo -->
            <div class="flex-grow flex flex-col items-center justify-center">
                <div class="logo-animation mb-8">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="#FFD700" stroke-width="5" />
                        <path d="M30,50 Q50,20 70,50 T30,50" fill="none" stroke="#FFD700" stroke-width="5" />
                        <circle cx="40" cy="40" r="5" fill="#FFD700">
                            <animate attributeName="cx" values="40;60;40" dur="3s" repeatCount="indefinite" />
                        </circle>
                    </svg>
                </div>
                <h1 id="game-title" class="text-5xl font-bold gold-text mb-10 glow">مغز شو</h1>
                
                <!-- Game buttons -->
                <div class="flex flex-col items-center space-y-4 mb-12">
                    <button id="start-game" class="btn py-3 px-8 rounded-lg text-xl font-bold w-48">شروع بازی</button>
                    <button id="online-game" class="btn py-2 px-6 rounded-lg text-lg font-bold w-40">بازی آنلاین</button>
                </div>
                
                <!-- Bottom buttons -->
                <div class="menu-buttons mb-6">
                    <button id="challenges-btn" class="btn btn-small rounded-lg">چالش‌ها</button>
                    <button id="chat-btn" class="btn btn-small rounded-lg">چت</button>
                    <button id="shop-btn" class="btn btn-small rounded-lg">فروشگاه</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="fixed inset-0 bg-black z-10 hidden">
        <div class="container mx-auto px-4 py-6 h-full flex flex-col">
            <!-- Header with level info -->
            <div class="flex items-center justify-between mb-4">
                <button id="back-to-menu" class="btn py-2 px-4 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <div class="flex items-center">
                    <span id="difficulty-badge" class="difficulty-badge difficulty-easy">آسان</span>
                    <span class="gold-text font-bold">مرحله: </span>
                    <span id="level-number" class="gold-text font-bold mr-1">1</span>
                </div>
                <div id="special-buttons" class="flex space-x-2 rtl:space-x-reverse">
                    <!-- Special buttons will be added here dynamically -->
                </div>
            </div>
            
            <!-- Timer Bar -->
            <div class="w-full h-2 bg-gray-800 rounded-full overflow-hidden mb-4">
                <div id="timer-bar" class="timer-bar" style="width: 100%"></div>
            </div>
            
            <!-- Puzzle Container -->
            <div class="flex-grow flex flex-col items-center justify-center">
                <div id="puzzle-container" class="w-full max-w-lg">
                    <!-- Puzzle content will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gold-text">تنظیمات</h2>
                <button id="close-settings" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <button id="creators-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                    سازندگان
                </button>
                
                <div>
                    <label for="gift-code" class="block text-sm font-medium mb-1">کد هدیه</label>
                    <div class="flex space-x-2 rtl:space-x-reverse">
                        <input type="text" id="gift-code" class="flex-grow px-4 py-2 bg-gray-900 border gold-border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        <button id="submit-code" class="btn py-2 px-4 rounded-lg">ثبت</button>
                    </div>
                </div>
                
                <div id="account-status" class="p-3 bg-gray-900 rounded-lg hidden">
                    <h3 class="font-bold gold-text mb-2">وضعیت حساب</h3>
                    <div id="account-details" class="text-sm">
                        <!-- Account details will be added here dynamically -->
                    </div>
                </div>
                
                <div id="creator-tools" class="p-3 bg-gray-900 rounded-lg hidden">
                    <h3 class="font-bold mb-2" style="color: #FF5722;">ابزارهای سازنده</h3>
                    <div class="space-y-2">
                        <button id="create-puzzle-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                            ساخت معمای جدید
                        </button>
                        <button id="generate-code-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                            ساخت کد هدیه
                        </button>
                        <button id="theme-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                            تغییر تم بازی
                        </button>
                        <button id="manage-users-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                            مدیریت کاربران
                        </button>
                        <button id="analytics-btn" class="w-full btn py-2 px-4 rounded-lg text-right">
                            آمار بازی
                        </button>
                    </div>
                </div>
                
                <div class="pt-4 border-t border-gray-700">
                    <button id="logout-btn" class="w-full py-2 px-4 rounded-lg bg-red-900 text-white hover:bg-red-800 transition">
                        خروج از حساب
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Creators Modal -->
    <div id="creators-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gold-text">سازندگان</h2>
                <button id="close-creators" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="p-3 bg-gray-900 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-bold gold-text">کدنویس ارشد</span>
                        <span>Ali.k</span>
                    </div>
                </div>
                
                <div class="p-3 bg-gray-900 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-bold gold-text">کدنویس دوم</span>
                        <span>abolfazl1401</span>
                    </div>
                </div>
                
                <div class="p-3 bg-gray-900 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-bold gold-text">طراح</span>
                        <span>ivar</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Coming Soon Modal -->
    <div id="coming-soon-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in">
            <h2 class="text-2xl font-bold gold-text text-center mb-4">به زودی</h2>
            <p class="text-center mb-6">این بخش به زودی اضافه خواهد شد!</p>
            <button id="close-modal" class="w-full btn py-2 px-4 rounded-lg">بازگشت</button>
        </div>
    </div>

    <!-- Creator Privileges Modal -->
    <div id="creator-privileges-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in creator-bg">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold creator-glow" style="color: #FF5722;">دسترسی سازنده</h2>
                <button id="close-creator-privileges" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <p class="text-center mb-4">تبریک! شما به عنوان سازنده بازی شناخته شدید!</p>
                
                <div class="p-3 bg-gray-900 bg-opacity-70 rounded-lg">
                    <h3 class="font-bold mb-2" style="color: #FF5722;">دسترسی‌های ویژه:</h3>
                    <ul class="list-disc list-inside space-y-2 text-sm">
                        <li>سکه و جایزه نامحدود</li>
                        <li>دسترسی به تمام مراحل بازی</li>
                        <li>امکان رد کردن مراحل</li>
                        <li>افکت‌های ویژه طلایی</li>
                        <li>انیمیشن‌های مخصوص سازنده</li>
                        <li>امکان ویرایش معماها</li>
                        <li>دسترسی به بخش‌های در حال توسعه</li>
                        <li>امکان اضافه کردن معماهای جدید</li>
                        <li>تغییر ظاهر بازی</li>
                        <li>امکان ایجاد کد هدیه</li>
                        <li>آواتار مخصوص سازنده</li>
                        <li>امکان تغییر سختی معماها</li>
                        <li>دسترسی به تمام آواتارها</li>
                        <li>امکان ساخت تم اختصاصی</li>
                        <li>امکان ساخت چالش‌های ویژه</li>
                        <li>مدیریت کاربران</li>
                        <li>مشاهده آمار بازی</li>
                        <li>امکان ساخت رویدادهای ویژه</li>
                        <li>دسترسی به API بازی</li>
                        <li>امکان تغییر پارامترهای بازی</li>
                    </ul>
                </div>
                
                <button id="activate-creator" class="w-full py-2 px-4 rounded-lg text-white font-bold" style="background: linear-gradient(145deg, #FF5722, #FF9800);">
                    فعال‌سازی دسترسی‌ها
                </button>
            </div>
        </div>
    </div>

    <!-- VIP Privileges Modal -->
    <div id="vip-privileges-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in vip-bg">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold vip-glow" style="color: #9C27B0;">دسترسی VIP</h2>
                <button id="close-vip-privileges" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <p class="text-center mb-4">تبریک! شما به عنوان کاربر ویژه شناخته شدید!</p>
                
                <div class="p-3 bg-gray-900 bg-opacity-70 rounded-lg">
                    <h3 class="font-bold mb-2" style="color: #9C27B0;">دسترسی‌های ویژه:</h3>
                    <ul class="list-disc list-inside space-y-2 text-sm">
                        <li>پاداش دو برابر برای حل معماها</li>
                        <li>دسترسی به راهنمایی‌های ویژه</li>
                        <li>انیمیشن‌های مخصوص VIP</li>
                        <li>رنگ‌بندی اختصاصی VIP</li>
                        <li>دسترسی به معماهای ویژه</li>
                        <li>امکان ذخیره پیشرفت در چند دستگاه</li>
                        <li>دسترسی زودتر به بخش‌های جدید</li>
                        <li>آواتار مخصوص VIP</li>
                        <li>زمان بیشتر برای حل معماها</li>
                    </ul>
                </div>
                
                <button id="activate-vip" class="w-full py-2 px-4 rounded-lg text-white font-bold" style="background: linear-gradient(145deg, #9C27B0, #673AB7);">
                    فعال‌سازی دسترسی‌ها
                </button>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shop-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="puzzle-card p-6 rounded-lg w-11/12 max-w-md slide-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gold-text">فروشگاه</h2>
                <button id="close-shop" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="mb-4 flex justify-between items-center">
                <span class="font-bold">موجودی:</span>
                <div class="flex items-center">
                    <span class="coin-icon mr-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </span>
                    <span id="shop-coins" class="text-sm font-bold text-yellow-400">100</span>
                </div>
            </div>
            
            <div class="mb-4">
                <h3 class="font-bold gold-text mb-2">آواتارها</h3>
                <div class="grid grid-cols-2 gap-3" id="avatar-items">
                    <div class="shop-item" data-avatar="avatar-black-gold" data-price="0">
                        <div class="avatar-preview avatar-black-gold"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">مشکی-طلایی</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">0</span>
                            </div>
                            <div class="mt-2">
                                <span class="text-xs text-green-500">فعال</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-black-red" data-price="100">
                        <div class="avatar-preview avatar-black-red"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">مشکی-قرمز</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">100</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-red-gold" data-price="150">
                        <div class="avatar-preview avatar-red-gold"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">قرمز-طلایی</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">150</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-purple-gold" data-price="200">
                        <div class="avatar-preview avatar-purple-gold"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">بنفش-طلایی</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">200</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-blue-gold" data-price="200">
                        <div class="avatar-preview avatar-blue-gold"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">آبی-طلایی</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">200</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-green-gold" data-price="200">
                        <div class="avatar-preview avatar-green-gold"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">سبز-طلایی</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">200</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                    
                    <div class="shop-item" data-avatar="avatar-rainbow" data-price="500">
                        <div class="avatar-preview avatar-rainbow"></div>
                        <div class="text-center mt-2">
                            <div class="font-bold text-sm">رنگین‌کمان</div>
                            <div class="flex items-center justify-center mt-1">
                                <span class="coin-icon mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </span>
                                <span class="text-xs font-bold text-yellow-400">500</span>
                            </div>
                            <button class="mt-2 px-2 py-1 bg-yellow-600 text-white text-xs rounded-md hover:bg-yellow-500 transition">خرید</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button id="close-shop-btn" class="btn py-2 px-6 rounded-lg">بازگشت</button>
            </div>
        </div>
    </div>

    <script>
        // Store game data
        const gameData = {
            player: {
                name: '',
                level: 1,
                score: 0,
                coins: 100,
                trophies: 0,
                xp: 20,
                badges: [],
                isCreator: false,
                isVIP: false,
                avatars: ['avatar-black-gold'],
                currentAvatar: 'avatar-black-gold'
            },
            puzzles: [
                {
                    type: 'multipleChoice',
                    question: 'کدام عدد در دنباله زیر می‌آید؟<br>2, 4, 8, 16, ...',
                    options: ['24', '32', '30', '20'],
                    correctAnswer: 1,
                    hint: 'هر عدد دو برابر عدد قبلی است.',
                    difficulty: 'easy',
                    timeLimit: 30
                },
                {
                    type: 'multipleChoice',
                    question: 'اگر امروز دوشنبه باشد، 15 روز بعد چه روزی است؟',
                    options: ['دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه'],
                    correctAnswer: 2,
                    hint: '15 را تقسیم بر 7 کنید و باقیمانده را در نظر بگیرید.',
                    difficulty: 'easy',
                    timeLimit: 30
                },
                {
                    type: 'wordPuzzle',
                    question: 'با کلمات زیر یک ضرب‌المثل معروف بسازید:',
                    words: ['نابرده', 'گنج', 'میسر', 'رنج', 'نمی‌شود'],
                    correctOrder: [0, 2, 1, 3, 4],
                    hint: 'این ضرب‌المثل درباره تلاش و پاداش است.',
                    difficulty: 'medium',
                    timeLimit: 45
                },
                {
                    type: 'multipleChoice',
                    question: 'کدام گزینه با بقیه متفاوت است؟',
                    options: ['سیب', 'پرتقال', 'خیار', 'انار'],
                    correctAnswer: 2,
                    hint: 'به دسته‌بندی میوه‌ها و سبزیجات توجه کنید.',
                    difficulty: 'easy',
                    timeLimit: 20
                },
                {
                    type: 'wordPuzzle',
                    question: 'با حروف زیر یک کلمه پنج حرفی بسازید:',
                    words: ['ب', 'ا', 'ت', 'ک', 'ی'],
                    correctOrder: [2, 0, 4, 1, 3],
                    hint: 'این کلمه نام یک وسیله نقلیه است.',
                    difficulty: 'medium',
                    timeLimit: 40
                },
                // New harder puzzles
                {
                    type: 'multipleChoice',
                    question: 'اگر 2 + 3 = 10, 4 + 5 = 18, 7 + 2 = 18, پس 8 + 4 = ?',
                    options: ['24', '32', '48', '36'],
                    correctAnswer: 0,
                    hint: 'به جای جمع، از ضرب و جمع استفاده کنید: (a × b) + (a + b)',
                    difficulty: 'hard',
                    timeLimit: 60
                },
                {
                    type: 'multipleChoice',
                    question: 'در یک مسابقه، علی از رضا جلوتر است و محمد از علی عقب‌تر است. حسن از رضا عقب‌تر است. چه کسی در رتبه دوم است؟',
                    options: ['علی', 'رضا', 'محمد', 'حسن'],
                    correctAnswer: 1,
                    hint: 'ترتیب را از اول تا آخر بنویسید.',
                    difficulty: 'hard',
                    timeLimit: 90
                },
                {
                    type: 'multipleChoice',
                    question: 'عدد بعدی در این دنباله چیست؟<br>1, 4, 9, 16, 25, ...',
                    options: ['30', '36', '42', '49'],
                    correctAnswer: 1,
                    hint: 'به مجذور اعداد طبیعی توجه کنید.',
                    difficulty: 'medium',
                    timeLimit: 45
                },
                {
                    type: 'multipleChoice',
                    question: 'مقدار X را در معادله زیر پیدا کنید:<br>2X + 5 = 3X - 7',
                    options: ['12', '10', '8', '-12'],
                    correctAnswer: 0,
                    hint: 'معادله را به شکل استاندارد بنویسید و X را محاسبه کنید.',
                    difficulty: 'hard',
                    timeLimit: 60
                },
                {
                    type: 'multipleChoice',
                    question: 'یک مکعب با ابعاد 3×3×3 از 27 مکعب کوچک 1×1×1 ساخته شده است. اگر تمام وجوه خارجی را رنگ کنیم، چند مکعب کوچک دقیقاً دو وجه رنگی خواهند داشت؟',
                    options: ['8', '12', '24', '6'],
                    correctAnswer: 1,
                    hint: 'به لبه‌های مکعب بزرگ توجه کنید.',
                    difficulty: 'expert',
                    timeLimit: 120
                },
                // Even harder puzzles
                {
                    type: 'multipleChoice',
                    question: 'در یک دنباله، هر عدد برابر است با مجموع دو عدد قبلی. اگر دو عدد اول 3 و 5 باشند، عدد هشتم چیست؟',
                    options: ['89', '144', '233', '377'],
                    correctAnswer: 2,
                    hint: 'دنباله فیبوناچی را با شروع از 3 و 5 بسازید.',
                    difficulty: 'expert',
                    timeLimit: 90
                },
                {
                    type: 'multipleChoice',
                    question: 'اگر log₂(x) = 5، مقدار x چیست؟',
                    options: ['10', '25', '32', '64'],
                    correctAnswer: 2,
                    hint: 'از تعریف لگاریتم استفاده کنید: اگر log₂(x) = 5، پس 2^5 = x',
                    difficulty: 'hard',
                    timeLimit: 60
                },
                {
                    type: 'multipleChoice',
                    question: 'در یک کیسه 5 توپ قرمز، 3 توپ آبی و 2 توپ سبز وجود دارد. اگر 2 توپ به تصادف از کیسه خارج کنیم، احتمال اینکه هر دو توپ همرنگ باشند چقدر است؟',
                    options: ['7/15', '2/5', '1/3', '11/30'],
                    correctAnswer: 0,
                    hint: 'احتمال انتخاب دو توپ قرمز + احتمال انتخاب دو توپ آبی + احتمال انتخاب دو توپ سبز',
                    difficulty: 'expert',
                    timeLimit: 120
                },
                {
                    type: 'multipleChoice',
                    question: 'عدد بعدی در این دنباله چیست؟<br>3, 6, 12, 24, 48, ...',
                    options: ['72', '96', '108', '120'],
                    correctAnswer: 1,
                    hint: 'به الگوی ضرب در هر مرحله توجه کنید.',
                    difficulty: 'hard',
                    timeLimit: 45
                },
                {
                    type: 'multipleChoice',
                    question: 'اگر 5 نفر به 5 طریق مختلف می‌توانند در یک صف بایستند، به چند طریق مختلف می‌توانند دور یک میز گرد بنشینند؟',
                    options: ['120', '60', '24', '20'],
                    correctAnswer: 2,
                    hint: 'در چینش دایره‌ای، چرخش‌های مختلف یک چینش، معادل هم هستند.',
                    difficulty: 'expert',
                    timeLimit: 90
                }
            ],
            currentPuzzleIndex: 0,
            creatorCode: 'a.av1401.d1401a.av.li.vd.ab.',
            vipCode: 'VIP.asp./(VIP)./pvi)/aal.',
            giftCodes: [],
            timer: null,
            timeLeft: 0
        };

        // DOM Elements
        const splashScreen = document.getElementById('splash-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const loadingBar = document.getElementById('loading-bar');
        const loadingText = document.getElementById('loading-text');
        const registrationScreen = document.getElementById('registration-screen');
        const registrationForm = document.getElementById('registration-form');
        const usernameInput = document.getElementById('username');
        const mainMenu = document.getElementById('main-menu');
        const gameTitle = document.getElementById('game-title');
        const playerName = document.getElementById('player-name');
        const playerCoins = document.getElementById('player-coins');
        const playerTrophies = document.getElementById('player-trophies');
        const playerLevel = document.getElementById('player-level');
        const playerXpBar = document.getElementById('player-xp-bar');
        const playerBadges = document.getElementById('player-badges');
        const playerAvatar = document.getElementById('player-avatar');
        const startGameBtn = document.getElementById('start-game');
        const onlineGameBtn = document.getElementById('online-game');
        const gameScreen = document.getElementById('game-screen');
        const backToMenuBtn = document.getElementById('back-to-menu');
        const levelNumber = document.getElementById('level-number');
        const difficultyBadge = document.getElementById('difficulty-badge');
        const puzzleContainer = document.getElementById('puzzle-container');
        const specialButtons = document.getElementById('special-buttons');
        const timerBar = document.getElementById('timer-bar');
        const comingSoonModal = document.getElementById('coming-soon-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const settingsButton = document.getElementById('settings-button');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings');
        const creatorsBtn = document.getElementById('creators-btn');
        const creatorsModal = document.getElementById('creators-modal');
        const closeCreatorsBtn = document.getElementById('close-creators');
        const giftCodeInput = document.getElementById('gift-code');
        const submitCodeBtn = document.getElementById('submit-code');
        const logoutBtn = document.getElementById('logout-btn');
        const accountStatus = document.getElementById('account-status');
        const accountDetails = document.getElementById('account-details');
        const creatorTools = document.getElementById('creator-tools');
        const creatorPrivilegesModal = document.getElementById('creator-privileges-modal');
        const closeCreatorPrivilegesBtn = document.getElementById('close-creator-privileges');
        const activateCreatorBtn = document.getElementById('activate-creator');
        const vipPrivilegesModal = document.getElementById('vip-privileges-modal');
        const closeVipPrivilegesBtn = document.getElementById('close-vip-privileges');
        const activateVipBtn = document.getElementById('activate-vip');
        const shopBtn = document.getElementById('shop-btn');
        const shopModal = document.getElementById('shop-modal');
        const closeShopBtn = document.getElementById('close-shop');
        const closeShopBtn2 = document.getElementById('close-shop-btn');
        const shopCoins = document.getElementById('shop-coins');
        const avatarItems = document.getElementById('avatar-items');
        const challengesBtn = document.getElementById('challenges-btn');
        const chatBtn = document.getElementById('chat-btn');

        // Initialize game
        document.addEventListener('DOMContentLoaded', function() {
            // Show splash screen for 2 seconds
            setTimeout(function() {
                splashScreen.style.display = 'none';
                loadingScreen.style.display = 'flex';
                startLoading();
            }, 2000);
            
            // Event listeners
            registrationForm.addEventListener('submit', handleRegistration);
            startGameBtn.addEventListener('click', startGame);
            onlineGameBtn.addEventListener('click', showComingSoon);
            backToMenuBtn.addEventListener('click', backToMenu);
            closeModalBtn.addEventListener('click', closeModal);
            settingsButton.addEventListener('click', showSettings);
            closeSettingsBtn.addEventListener('click', closeSettings);
            creatorsBtn.addEventListener('click', showCreators);
            closeCreatorsBtn.addEventListener('click', closeCreators);
            submitCodeBtn.addEventListener('click', submitCode);
            logoutBtn.addEventListener('click', logout);
            closeCreatorPrivilegesBtn.addEventListener('click', closeCreatorPrivileges);
            activateCreatorBtn.addEventListener('click', activateCreator);
            closeVipPrivilegesBtn.addEventListener('click', closeVipPrivileges);
            activateVipBtn.addEventListener('click', activateVip);
            shopBtn.addEventListener('click', showShop);
            closeShopBtn.addEventListener('click', closeShop);
            closeShopBtn2.addEventListener('click', closeShop);
            challengesBtn.addEventListener('click', showComingSoon);
            chatBtn.addEventListener('click', showComingSoon);
            
            // Setup shop items
            setupShopItems();
        });

        // Start loading animation
        function startLoading() {
            let progress = 0;
            const interval = setInterval(function() {
                progress += 5;
                loadingBar.style.width = `${progress}%`;
                loadingText.textContent = `در حال بارگذاری... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(function() {
                        loadingScreen.style.display = 'none';
                        
                        // Check if user is already registered
                        if (localStorage.getItem('brainGameData')) {
                            loadSavedData();
                            mainMenu.style.display = 'block';
                        } else {
                            registrationScreen.style.display = 'flex';
                        }
                    }, 500);
                }
            }, 100);
        }

        // Handle registration
        function handleRegistration(e) {
            e.preventDefault();
            const username = usernameInput.value.trim();
            
            if (username) {
                gameData.player.name = username;
                saveGameData();
                registrationScreen.style.display = 'none';
                mainMenu.style.display = 'block';
                updatePlayerUI();
            }
        }

        // Start game
        function startGame() {
            mainMenu.style.display = 'none';
            gameScreen.style.display = 'block';
            levelNumber.textContent = gameData.currentPuzzleIndex + 1;
            showCurrentPuzzle();
        }

        // Show current puzzle
        function showCurrentPuzzle() {
            const currentPuzzle = gameData.puzzles[gameData.currentPuzzleIndex];
            
            // Update difficulty badge
            difficultyBadge.className = `difficulty-badge difficulty-${currentPuzzle.difficulty}`;
            difficultyBadge.textContent = getDifficultyText(currentPuzzle.difficulty);
            
            // Clear previous puzzle
            puzzleContainer.innerHTML = '';
            
            // Create puzzle based on type
            if (currentPuzzle.type === 'multipleChoice') {
                createMultipleChoicePuzzle(currentPuzzle);
            } else if (currentPuzzle.type === 'wordPuzzle') {
                createWordPuzzle(currentPuzzle);
            }
            
            // Start timer
            startTimer(currentPuzzle.timeLimit);
            
            // Update special buttons
            updateSpecialButtons();
        }

        // Create multiple choice puzzle
        function createMultipleChoicePuzzle(puzzle) {
            const puzzleCard = document.createElement('div');
            puzzleCard.className = 'puzzle-card p-6 rounded-lg slide-in';
            
            // Question
            const question = document.createElement('div');
            question.className = 'text-xl font-bold mb-6 text-center';
            question.innerHTML = puzzle.question;
            puzzleCard.appendChild(question);
            
            // Options
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'space-y-4';
            
            puzzle.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option p-4 rounded-lg cursor-pointer text-center';
                optionDiv.textContent = option;
                optionDiv.dataset.index = index;
                
                optionDiv.addEventListener('click', function() {
                    selectOption(this, puzzle.correctAnswer);
                });
                
                optionsContainer.appendChild(optionDiv);
            });
            
            puzzleCard.appendChild(optionsContainer);
            puzzleContainer.appendChild(puzzleCard);
        }

        // Create word puzzle
        function createWordPuzzle(puzzle) {
            const puzzleCard = document.createElement('div');
            puzzleCard.className = 'puzzle-card p-6 rounded-lg slide-in';
            
            // Question
            const question = document.createElement('div');
            question.className = 'text-xl font-bold mb-6 text-center';
            question.innerHTML = puzzle.question;
            puzzleCard.appendChild(question);
            
            // Word pieces container
            const wordPiecesContainer = document.createElement('div');
            wordPiecesContainer.className = 'flex flex-wrap justify-center mb-6';
            
            // Shuffle words
            const shuffledWords = [...puzzle.words];
            for (let i = shuffledWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledWords[i], shuffledWords[j]] = [shuffledWords[j], shuffledWords[i]];
            }
            
            // Create word pieces
            shuffledWords.forEach((word, index) => {
                const wordPiece = document.createElement('div');
                wordPiece.className = 'word-piece';
                wordPiece.textContent = word;
                wordPiece.dataset.word = word;
                wordPiece.dataset.originalIndex = puzzle.words.indexOf(word);
                
                wordPiece.addEventListener('click', function() {
                    selectWordPiece(this);
                });
                
                wordPiecesContainer.appendChild(wordPiece);
            });
            
            puzzleCard.appendChild(wordPiecesContainer);
            
            // Answer container
            const answerContainer = document.createElement('div');
            answerContainer.className = 'word-container p-4 flex flex-wrap justify-center';
            puzzleCard.appendChild(answerContainer);
            
            // Check button
            const checkButton = document.createElement('button');
            checkButton.className = 'btn py-2 px-4 rounded-lg mt-6 mx-auto block';
            checkButton.textContent = 'بررسی پاسخ';
            checkButton.addEventListener('click', function() {
                checkWordPuzzle(puzzle.correctOrder);
            });
            puzzleCard.appendChild(checkButton);
            
            puzzleContainer.appendChild(puzzleCard);
        }

        // Select option in multiple choice puzzle
        function selectOption(option, correctAnswer) {
            // Remove selected class from all options
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected', 'correct', 'wrong'));
            
            // Add selected class to clicked option
            option.classList.add('selected');
            
            // Check answer
            const selectedIndex = parseInt(option.dataset.index);
            
            setTimeout(() => {
                if (selectedIndex === correctAnswer) {
                    option.classList.add('correct');
                    puzzleSolved();
                } else {
                    option.classList.add('wrong');
                    options[correctAnswer].classList.add('correct');
                    puzzleFailed();
                }
                
                // Disable all options
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
                
                // Stop timer
                clearInterval(gameData.timer);
            }, 500);
        }

        // Select word piece in word puzzle
        function selectWordPiece(piece) {
            const answerContainer = document.querySelector('.word-container');
            
            if (piece.parentNode.classList.contains('word-container')) {
                // Move back to word pieces container
                const wordPiecesContainer = document.querySelector('.puzzle-card > div:nth-child(2)');
                piece.classList.remove('selected');
                wordPiecesContainer.appendChild(piece);
            } else {
                // Move to answer container
                piece.classList.add('selected');
                answerContainer.appendChild(piece);
            }
        }

        // Check word puzzle answer
        function checkWordPuzzle(correctOrder) {
            const answerContainer = document.querySelector('.word-container');
            const selectedPieces = answerContainer.querySelectorAll('.word-piece');
            
            // Check if all words are selected
            if (selectedPieces.length !== correctOrder.length) {
                alert('لطفاً تمام کلمات را مرتب کنید!');
                return;
            }
            
            // Check order
            let isCorrect = true;
            selectedPieces.forEach((piece, index) => {
                const originalIndex = parseInt(piece.dataset.originalIndex);
                if (originalIndex !== correctOrder[index]) {
                    isCorrect = false;
                }
            });
            
            // Show result
            if (isCorrect) {
                selectedPieces.forEach(piece => {
                    piece.style.borderColor = '#4CAF50';
                    piece.style.backgroundColor = '#2a6a2a';
                });
                puzzleSolved();
            } else {
                selectedPieces.forEach(piece => {
                    piece.style.borderColor = '#F44336';
                    piece.style.backgroundColor = '#6a2a2a';
                });
                puzzleFailed();
            }
            
            // Disable all pieces
            const allPieces = document.querySelectorAll('.word-piece');
            allPieces.forEach(piece => {
                piece.style.pointerEvents = 'none';
            });
            
            // Disable check button
            document.querySelector('.puzzle-card button').disabled = true;
            
            // Stop timer
            clearInterval(gameData.timer);
        }

        // Puzzle solved
        function puzzleSolved() {
            // Calculate reward based on difficulty and time left
            const currentPuzzle = gameData.puzzles[gameData.currentPuzzleIndex];
            let coinsReward = 10;
            let xpReward = 5;
            
            switch (currentPuzzle.difficulty) {
                case 'medium':
                    coinsReward = 20;
                    xpReward = 10;
                    break;
                case 'hard':
                    coinsReward = 30;
                    xpReward = 15;
                    break;
                case 'expert':
                    coinsReward = 50;
                    xpReward = 25;
                    break;
            }
            
            // Double reward for VIP
            if (gameData.player.isVIP) {
                coinsReward *= 2;
                xpReward *= 2;
            }
            
            // Add time bonus
            const timeBonus = Math.floor(gameData.timeLeft / 5);
            coinsReward += timeBonus;
            
            // Update player data
            gameData.player.coins += coinsReward;
            gameData.player.xp += xpReward;
            
            // Check if level up
            if (gameData.player.xp >= 100) {
                gameData.player.level++;
                gameData.player.xp -= 100;
                gameData.player.trophies++;
                
                // Show level up message
                setTimeout(() => {
                    alert(`تبریک! شما به سطح ${gameData.player.level} رسیدید!`);
                }, 1000);
            }
            
            // Show success message
            setTimeout(() => {
                alert(`آفرین! شما ${coinsReward} سکه و ${xpReward} امتیاز تجربه دریافت کردید!`);
                
                // Move to next puzzle
                gameData.currentPuzzleIndex++;
                if (gameData.currentPuzzleIndex >= gameData.puzzles.length) {
                    gameData.currentPuzzleIndex = 0;
                }
                
                // Update UI
                updatePlayerUI();
                levelNumber.textContent = gameData.currentPuzzleIndex + 1;
                showCurrentPuzzle();
                
                // Save game data
                saveGameData();
                
                // Create confetti effect
                createConfetti();
            }, 1500);
        }

        // Puzzle failed
        function puzzleFailed() {
            // Show failure message
            setTimeout(() => {
                alert('متأسفانه پاسخ شما اشتباه بود! دوباره تلاش کنید.');
                
                // Move to next puzzle
                gameData.currentPuzzleIndex++;
                if (gameData.currentPuzzleIndex >= gameData.puzzles.length) {
                    gameData.currentPuzzleIndex = 0;
                }
                
                // Update UI
                levelNumber.textContent = gameData.currentPuzzleIndex + 1;
                showCurrentPuzzle();
                
                // Save game data
                saveGameData();
            }, 1500);
        }

        // Start timer
        function startTimer(seconds) {
            // Clear previous timer
            if (gameData.timer) {
                clearInterval(gameData.timer);
            }
            
            // Set initial time
            gameData.timeLeft = seconds;
            timerBar.style.width = '100%';
            
            // Start countdown
            gameData.timer = setInterval(() => {
                gameData.timeLeft--;
                
                // Update timer bar
                const percentage = (gameData.timeLeft / seconds) * 100;
                timerBar.style.width = `${percentage}%`;
                
                // Check if time is up
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timer);
                    
                    // Show time up message
                    alert('زمان تمام شد!');
                    
                    // Move to next puzzle
                    gameData.currentPuzzleIndex++;
                    if (gameData.currentPuzzleIndex >= gameData.puzzles.length) {
                        gameData.currentPuzzleIndex = 0;
                    }
                    
                    // Update UI
                    levelNumber.textContent = gameData.currentPuzzleIndex + 1;
                    showCurrentPuzzle();
                    
                    // Save game data
                    saveGameData();
                }
            }, 1000);
        }

        // Back to menu
        function backToMenu() {
            // Clear timer
            if (gameData.timer) {
                clearInterval(gameData.timer);
            }
            
            gameScreen.style.display = 'none';
            mainMenu.style.display = 'block';
        }

        // Show coming soon modal
        function showComingSoon() {
            comingSoonModal.style.display = 'flex';
        }

        // Close modal
        function closeModal() {
            comingSoonModal.style.display = 'none';
        }

        // Show settings
        function showSettings() {
            settingsModal.style.display = 'flex';
        }

        // Close settings
        function closeSettings() {
            settingsModal.style.display = 'none';
        }

        // Show creators
        function showCreators() {
            creatorsModal.style.display = 'flex';
            settingsModal.style.display = 'none';
        }

        // Close creators
        function closeCreators() {
            creatorsModal.style.display = 'none';
            settingsModal.style.display = 'flex';
        }

        // Submit gift code
        function submitCode() {
            const code = giftCodeInput.value.trim();
            
            if (!code) {
                alert('لطفاً کد هدیه را وارد کنید!');
                return;
            }
            
            // Check for creator code - FIXED: Exact string comparison
            if (code === gameData.creatorCode) {
                if (!gameData.player.isCreator) {
                    // Show creator privileges modal
                    creatorPrivilegesModal.style.display = 'flex';
                    settingsModal.style.display = 'none';
                } else {
                    alert('شما قبلاً دسترسی سازنده را فعال کرده‌اید!');
                }
                giftCodeInput.value = '';
                return;
            }
            
            // Check for VIP code - FIXED: Exact string comparison
            if (code === gameData.vipCode) {
                if (!gameData.player.isVIP && !gameData.player.isCreator) {
                    vipPrivilegesModal.style.display = 'flex';
                    settingsModal.style.display = 'none';
                } else if (gameData.player.isCreator) {
                    alert('شما دسترسی سازنده دارید که شامل تمام امکانات VIP نیز می‌شود!');
                } else {
                    alert('شما قبلاً دسترسی VIP را فعال کرده‌اید!');
                }
                giftCodeInput.value = '';
                return;
            }
            
            // Check for custom gift codes
            const giftCode = gameData.giftCodes.find(gc => gc.code === code && !gc.used);
            
            if (giftCode) {
                // Check if code is expired
                const now = new Date().getTime();
                if (giftCode.expiry < now) {
                    alert('این کد هدیه منقضی شده است!');
                    giftCodeInput.value = '';
                    return;
                }
                
                // Apply gift code
                switch (giftCode.type) {
                    case 'coins':
                        gameData.player.coins += giftCode.value;
                        alert(`تبریک! ${giftCode.value} سکه به حساب شما اضافه شد!`);
                        break;
                    case 'vip':
                        if (!gameData.player.isVIP && !gameData.player.isCreator) {
                            vipPrivilegesModal.style.display = 'flex';
                            settingsModal.style.display = 'none';
                        } else if (gameData.player.isCreator) {
                            alert('شما دسترسی سازنده دارید که شامل تمام امکانات VIP نیز می‌شود!');
                        } else {
                            alert('شما قبلاً دسترسی VIP را فعال کرده‌اید!');
                        }
                        break;
                    case 'avatar':
                        // Add all avatars
                        const allAvatars = [
                            'avatar-black-gold', 'avatar-black-red', 'avatar-red-gold',
                            'avatar-purple-gold', 'avatar-blue-gold', 'avatar-green-gold',
                            'avatar-rainbow'
                        ];
                        
                        allAvatars.forEach(avatar => {
                            if (!gameData.player.avatars.includes(avatar)) {
                                gameData.player.avatars.push(avatar);
                            }
                        });
                        
                        alert('تبریک! تمام آواتارها برای شما فعال شدند!');
                        break;
                }
                
                // Mark code as used
                giftCode.used = true;
                
                // Update UI
                updatePlayerUI();
                updateShopUI();
                
                // Save game data
                saveGameData();
                
                giftCodeInput.value = '';
            } else {
                alert('کد هدیه نامعتبر است!');
            }
        }

        // Logout
        function logout() {
            if (confirm('آیا مطمئن هستید که می‌خواهید از حساب خود خارج شوید؟')) {
                localStorage.removeItem('brainGameData');
                location.reload();
            }
        }

        // Close creator privileges modal
        function closeCreatorPrivileges() {
            creatorPrivilegesModal.style.display = 'none';
            settingsModal.style.display = 'flex';
        }

        // Activate creator privileges
        function activateCreator() {
            gameData.player.isCreator = true;
            
            // Add creator badge
            if (!gameData.player.badges.some(badge => badge.name === 'سازنده')) {
                gameData.player.badges.push({
                    name: 'سازنده',
                    class: 'creator-badge'
                });
            }
            
            // Add creator avatar
            if (!gameData.player.avatars.includes('avatar-creator')) {
                gameData.player.avatars.push('avatar-creator');
                gameData.player.currentAvatar = 'avatar-creator';
            }
            
            // Give access to all avatars
            const allAvatars = [
                'avatar-black-gold', 'avatar-black-red', 'avatar-red-gold',
                'avatar-purple-gold', 'avatar-blue-gold', 'avatar-green-gold',
                'avatar-rainbow'
            ];
            
            allAvatars.forEach(avatar => {
                if (!gameData.player.avatars.includes(avatar)) {
                    gameData.player.avatars.push(avatar);
                }
            });
            
            // Update UI
            updatePlayerUI();
            updateAccountStatus();
            applyUserPrivileges();
            updateShopUI();
            
            // Save game data
            saveGameData();
            
            // Close modal
            creatorPrivilegesModal.style.display = 'none';
            settingsModal.style.display = 'flex';
            
            // Show success message
            alert('تبریک! دسترسی‌های سازنده با موفقیت فعال شدند!');
            
            // Create special effect
            createCreatorConfetti();
        }

        // Close VIP privileges modal
        function closeVipPrivileges() {
            vipPrivilegesModal.style.display = 'none';
            settingsModal.style.display = 'flex';
        }

        // Activate VIP privileges
        function activateVip() {
            gameData.player.isVIP = true;
            
            // Add VIP badge
            if (!gameData.player.badges.some(badge => badge.name === 'VIP')) {
                gameData.player.badges.push({
                    name: 'VIP',
                    class: 'vip-badge'
                });
            }
            
            // Add VIP avatar
            if (!gameData.player.avatars.includes('avatar-vip')) {
                gameData.player.avatars.push('avatar-vip');
                gameData.player.currentAvatar = 'avatar-vip';
            }
            
            // Update UI
            updatePlayerUI();
            updateAccountStatus();
            applyUserPrivileges();
            updateShopUI();
            
            // Save game data
            saveGameData();
            
            // Close modal
            vipPrivilegesModal.style.display = 'none';
            settingsModal.style.display = 'flex';
            
            // Show success message
            alert('تبریک! دسترسی‌های VIP با موفقیت فعال شدند!');
            
            // Create special effect
            createVipConfetti();
        }

        // Show shop
        function showShop() {
            shopCoins.textContent = gameData.player.coins;
            shopModal.style.display = 'flex';
            updateShopUI();
        }

        // Close shop
        function closeShop() {
            shopModal.style.display = 'none';
        }

        // Setup shop items
        function setupShopItems() {
            const avatarItemElements = avatarItems.querySelectorAll('.shop-item');
            
            avatarItemElements.forEach(item => {
                const avatarClass = item.dataset.avatar;
                const price = parseInt(item.dataset.price);
                const button = item.querySelector('button');
                
                if (button) {
                    button.addEventListener('click', function(e) {
                        e.stopPropagation();
                        buyAvatar(avatarClass, price);
                    });
                }
                
                item.addEventListener('click', function() {
                    if (gameData.player.avatars.includes(avatarClass)) {
                        selectAvatar(avatarClass);
                    }
                });
            });
        }

        // Buy avatar
        function buyAvatar(avatarClass, price) {
            if (gameData.player.coins >= price) {
                gameData.player.coins -= price;
                gameData.player.avatars.push(avatarClass);
                gameData.player.currentAvatar = avatarClass;
                
                updatePlayerUI();
                updateShopUI();
                saveGameData();
                
                alert(`آواتار جدید با موفقیت خریداری شد!`);
            } else {
                alert('سکه کافی ندارید!');
            }
        }

        // Select avatar
        function selectAvatar(avatarClass) {
            if (gameData.player.avatars.includes(avatarClass)) {
                gameData.player.currentAvatar = avatarClass;
                
                updatePlayerUI();
                updateShopUI();
                saveGameData();
            }
        }

        // Update shop UI
        function updateShopUI() {
            shopCoins.textContent = gameData.player.coins;
            
            const avatarItemElements = avatarItems.querySelectorAll('.shop-item');
            
            avatarItemElements.forEach(item => {
                const avatarClass = item.dataset.avatar;
                const button = item.querySelector('button');
                const statusSpan = item.querySelector('.text-xs');
                
                if (gameData.player.avatars.includes(avatarClass)) {
                    // Player owns this avatar
                    if (button) {
                        button.remove();
                    }
                    
                    if (!statusSpan || !statusSpan.classList.contains('text-green-500')) {
                        const newStatus = document.createElement('span');
                        newStatus.className = 'text-xs text-green-500';
                        newStatus.textContent = gameData.player.currentAvatar === avatarClass ? 'فعال' : 'خریداری شده';
                        item.querySelector('.mt-2').appendChild(newStatus);
                    } else {
                        statusSpan.textContent = gameData.player.currentAvatar === avatarClass ? 'فعال' : 'خریداری شده';
                    }
                    
                    // Add selected class if this is the current avatar
                    if (gameData.player.currentAvatar === avatarClass) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                }
            });
        }

        // Load saved data if exists
        function loadSavedData() {
            const savedData = localStorage.getItem('brainGameData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                gameData.player = parsedData.player;
                gameData.currentPuzzleIndex = parsedData.currentPuzzleIndex;
                
                // If user has custom puzzles saved
                if (parsedData.puzzles) {
                    gameData.puzzles = parsedData.puzzles;
                }
                
                // If user has gift codes saved
                if (parsedData.giftCodes) {
                    gameData.giftCodes = parsedData.giftCodes;
                }
                
                updatePlayerUI();
                updateAccountStatus();
                applyUserPrivileges();
            }
        }

        // Save game data
        function saveGameData() {
            localStorage.setItem('brainGameData', JSON.stringify({
                player: gameData.player,
                currentPuzzleIndex: gameData.currentPuzzleIndex,
                puzzles: gameData.puzzles,
                giftCodes: gameData.giftCodes
            }));
        }

        // Update player UI elements
        function updatePlayerUI() {
            playerName.textContent = gameData.player.name;
            playerCoins.textContent = gameData.player.coins;
            playerTrophies.textContent = gameData.player.trophies;
            playerLevel.textContent = `سطح ${gameData.player.level}`;
            playerXpBar.style.width = `${gameData.player.xp}%`;
            
            // Update avatar
            playerAvatar.className = `profile-avatar w-16 h-16 rounded-lg mb-1 ${gameData.player.currentAvatar}`;
            
            // Update badges
            playerBadges.innerHTML = '';
            if (gameData.player.badges.length > 0) {
                gameData.player.badges.forEach(badge => {
                    const badgeElement = document.createElement('span');
                    badgeElement.className = `badge ${badge.class}`;
                    badgeElement.textContent = badge.name;
                    playerBadges.appendChild(badgeElement);
                });
            }
        }

        // Update account status in settings
        function updateAccountStatus() {
            if (gameData.player.isCreator || gameData.player.isVIP) {
                accountStatus.classList.remove('hidden');
                
                let statusHTML = '';
                if (gameData.player.isCreator) {
                    statusHTML += `<div class="flex justify-between items-center mb-2">
                        <span>وضعیت:</span>
                        <span class="badge creator-badge">سازنده</span>
                    </div>`;
                    
                    // Show creator tools
                    creatorTools.classList.remove('hidden');
                } else if (gameData.player.isVIP) {
                    statusHTML += `<div class="flex justify-between items-center mb-2">
                        <span>وضعیت:</span>
                        <span class="badge vip-badge">VIP</span>
                    </div>`;
                    
                    // Hide creator tools
                    creatorTools.classList.add('hidden');
                }
                
                accountDetails.innerHTML = statusHTML;
            } else {
                accountStatus.classList.add('hidden');
                creatorTools.classList.add('hidden');
            }
        }

        // Apply user privileges based on status
        function applyUserPrivileges() {
            if (gameData.player.isCreator) {
                // Apply creator privileges
                gameTitle.classList.remove('glow');
                gameTitle.classList.add('creator-glow');
                document.body.classList.add('creator-bg');
                
                // Set creator avatar if not already set
                if (!gameData.player.avatars.includes('avatar-creator')) {
                    gameData.player.avatars.push('avatar-creator');
                    gameData.player.currentAvatar = 'avatar-creator';
                    updatePlayerUI();
                }
                
                // Add creator badge if not already added
                if (!gameData.player.badges.some(badge => badge.name === 'سازنده')) {
                    gameData.player.badges.push({
                        name: 'سازنده',
                        class: 'creator-badge'
                    });
                    updatePlayerUI();
                }
                
                // Give access to all avatars
                const allAvatars = [
                    'avatar-black-gold', 'avatar-black-red', 'avatar-red-gold',
                    'avatar-purple-gold', 'avatar-blue-gold', 'avatar-green-gold',
                    'avatar-rainbow', 'avatar-creator'
                ];
                
                allAvatars.forEach(avatar => {
                    if (!gameData.player.avatars.includes(avatar)) {
                        gameData.player.avatars.push(avatar);
                    }
                });
                
                updateShopUI();
            } else if (gameData.player.isVIP) {
                // Apply VIP privileges
                gameTitle.classList.remove('glow');
                gameTitle.classList.add('vip-glow');
                document.body.classList.add('vip-bg');
                
                // Set VIP avatar if not already set
                if (!gameData.player.avatars.includes('avatar-vip')) {
                    gameData.player.avatars.push('avatar-vip');
                    gameData.player.currentAvatar = 'avatar-vip';
                    updatePlayerUI();
                }
                
                // Add VIP badge if not already added
                if (!gameData.player.badges.some(badge => badge.name === 'VIP')) {
                    gameData.player.badges.push({
                        name: 'VIP',
                        class: 'vip-badge'
                    });
                    updatePlayerUI();
                }
            }
            
            // Update special buttons in game screen
            updateSpecialButtons();
        }

        // Update special buttons in game screen
        function updateSpecialButtons() {
            specialButtons.innerHTML = '';
            
            if (gameData.player.isCreator) {
                // Add skip button
                const skipButton = document.createElement('button');
                skipButton.className = 'skip-button';
                skipButton.innerHTML = 'رد کردن';
                skipButton.addEventListener('click', skipPuzzle);
                specialButtons.appendChild(skipButton);
                
                // Add edit button
                const editButton = document.createElement('button');
                editButton.className = 'edit-button';
                editButton.innerHTML = 'ویرایش';
                editButton.addEventListener('click', showEditPuzzleModal);
                specialButtons.appendChild(editButton);
            } else if (gameData.player.isVIP) {
                // Add hint button
                const hintButton = document.createElement('button');
                hintButton.className = 'hint-button';
                hintButton.innerHTML = 'راهنمایی';
                hintButton.addEventListener('click', showHint);
                specialButtons.appendChild(hintButton);
            }
        }

        // Skip current puzzle (creator only)
        function skipPuzzle() {
            if (!gameData.player.isCreator) return;
            
            clearInterval(gameData.timer);
            
            gameData.currentPuzzleIndex++;
            if (gameData.currentPuzzleIndex >= gameData.puzzles.length) {
                gameData.currentPuzzleIndex = 0;
            }
            
            levelNumber.textContent = gameData.currentPuzzleIndex + 1;
            showCurrentPuzzle();
            saveGameData();
            
            // Show special effect
            createCreatorConfetti();
        }

        // Show hint for current puzzle (VIP only)
        function showHint() {
            if (!gameData.player.isVIP) return;
            
            const currentPuzzle = gameData.puzzles[gameData.currentPuzzleIndex];
            if (currentPuzzle.hint) {
                alert(`راهنمایی: ${currentPuzzle.hint}`);
                createVipConfetti();
            }
        }

        // Show edit puzzle modal (creator only)
        function showEditPuzzleModal() {
            if (!gameData.player.isCreator) return;
            
            alert('این قابلیت به زودی اضافه خواهد شد!');
            createCreatorConfetti();
        }

        // Create confetti effect
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // Animate confetti
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 200 + 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.transition = 'all 1s ease-out';
                    
                    setTimeout(() => {
                        confetti.style.opacity = '0';
                        setTimeout(() => {
                            confetti.remove();
                        }, 1000);
                    }, 1000);
                }, Math.random() * 500);
            }
        }

        // Create creator confetti effect
        function createCreatorConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'creator-confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // Animate confetti
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 200 + 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.transition = 'all 1s ease-out';
                    
                    setTimeout(() => {
                        confetti.style.opacity = '0';
                        setTimeout(() => {
                            confetti.remove();
                        }, 1000);
                    }, 1000);
                }, Math.random() * 500);
            }
        }

        // Create VIP confetti effect
        function createVipConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'vip-confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // Animate confetti
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 200 + 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.transition = 'all 1s ease-out';
                    
                    setTimeout(() => {
                        confetti.style.opacity = '0';
                        setTimeout(() => {
                            confetti.remove();
                        }, 1000);
                    }, 1000);
                }, Math.random() * 500);
            }
        }

        // Get random color
        function getRandomColor() {
            const colors = ['#FFD700', '#FF5722', '#4CAF50', '#2196F3', '#9C27B0', '#F44336'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Get difficulty text
        function getDifficultyText(difficulty) {
            switch (difficulty) {
                case 'easy':
                    return 'آسان';
                case 'medium':
                    return 'متوسط';
                case 'hard':
                    return 'سخت';
                case 'expert':
                    return 'خبره';
                default:
                    return 'آسان';
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'965477395629ea60',t:'MTc1MzUzODg3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
