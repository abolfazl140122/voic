<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مغز شو</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold-light: #f5d76e;
            --gold: #d4af37;
            --gold-dark: #996515;
            --black-light: #222222;
            --black: #111111;
            --black-dark: #000000;
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--black);
            color: var(--gold-light);
            overflow: hidden; /* Prevent scrollbars */
        }

        /* Animated background */
        #app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--black-dark), var(--black), var(--black-light));
            z-index: 0;
        }
        
        .gold-gradient { background: linear-gradient(135deg, var(--gold-light), var(--gold), var(--gold-dark)); }
        .black-gradient { background: linear-gradient(135deg, var(--black-light), var(--black), var(--black-dark)); }
        .gold-text { background: linear-gradient(to right, var(--gold-light), var(--gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gold-border { border: 2px solid; border-image-slice: 1; border-image-source: linear-gradient(to right, var(--gold-light), var(--gold-dark)); }
        
        /* Screen Transitions */
        .screen {
            position: fixed;
            inset: 0;
            z-index: 10;
            opacity: 1;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            visibility: visible;
        }
        .screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* Animations */
        .fade-in { animation: fadeIn 1s ease-in-out; }
        .scale-in { animation: scaleIn 0.5s ease-in-out forwards; }
        .pulse { animation: pulse 2s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .rotate { animation: rotate 10s linear infinite; }
        .shine-effect { position: relative; overflow: hidden; }
        .shine-effect::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0) 100%);
            transform: rotate(30deg); animation: shine 3s infinite linear;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); } 100% { transform: translateX(100%) rotate(30deg); }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.8) translateY(20px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .word-piece { cursor: pointer; transition: all 0.3s ease; }
        .word-piece:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--gold); }
        .word-piece.selected { transform: scale(0.9); opacity: 0.5; pointer-events: none; }
        
        /* Buttons with better feedback */
        .btn { transition: all 0.2s ease-out; }
        .btn:active { transform: scale(0.95); }
        .btn-gold { background: linear-gradient(135deg, var(--gold-light), var(--gold)); color: var(--black); }
        .btn-gold:hover { background: linear-gradient(135deg, var(--gold), var(--gold-dark)); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); }
        .btn-dark { background: linear-gradient(135deg, #333, #111); border: 1px solid var(--gold); color: var(--gold); }
        .btn-dark:hover { background: linear-gradient(135deg, #222, #000); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); }

        .creator-badge {
            position: absolute; top: -5px; right: -5px; width: 20px; height: 20px;
            background: linear-gradient(135deg, #ff0000, #ff6600); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: white; font-weight: bold; box-shadow: 0 0 5px rgba(255, 0, 0, 0.7);
        }
        /* ... Other styles from your original file ... */
    </style>
</head>
<body>
    <div id="app-background"></div>

    <!-- Splash Screen -->
    <div id="splash-screen" class="screen flex flex-col items-center justify-center bg-black z-50">
        <!-- ... content is same as before ... -->
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="screen flex-col items-center justify-center bg-black z-40 hidden">
         <!-- ... content is same as before ... -->
    </div>

    <!-- Registration Screen -->
    <div id="registration-screen" class="screen items-center justify-center bg-black z-30 hidden">
         <!-- ... content is same as before ... -->
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="screen bg-black z-20 hidden">
         <!-- ... content is same as before, but add .btn class to buttons ... -->
         <button id="start-game" class="btn w-full btn-gold py-4 px-6 rounded-xl text-2xl font-bold mb-4 shadow-lg shine-effect">
            شروع بازی
        </button>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
         <!-- ... content is same as before, but add .btn class to buttons ... -->
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen bg-black z-10 hidden">
        <div class="container mx-auto px-4 py-6 h-full flex flex-col">
            <!-- Header with level info -->
            <div class="flex items-center justify-between mb-6">
                <button id="back-to-menu" class="btn bg-gray-900 p-2 rounded-lg gold-border">
                    <!-- svg -->
                </button>
                <div class="bg-gray-900 px-4 py-2 rounded-lg gold-border">
                    <span class="text-gold-300 font-medium">مرحله: </span>
                    <span id="current-level" class="text-gold-300 font-bold">1</span>
                </div>
                <button id="hint-button" class="btn bg-gray-900 p-2 rounded-lg gold-border hidden">
                    <!-- svg -->
                </button>
            </div>
            
            <!-- Game content -->
            <div class="flex-1 flex flex-col">
                <!-- Puzzle container -->
                <div class="bg-gray-900 rounded-xl p-6 mb-6 shadow-lg puzzle-container gold-border">
                    <h2 id="puzzle-question" class="text-xl font-bold text-gold-300 mb-4 text-center">معمای مرحله</h2>
                </div>
                
                <!-- Answer container -->
                <div id="answer-container" class="bg-gray-900 rounded-xl p-6 shadow-lg gold-border">
                    <h3 class="text-lg font-medium text-gold-300 mb-4">پاسخ خود را انتخاب کنید:</h3>
                    <div id="answer-options" class="grid grid-cols-2 gap-4">
                        <!-- Options will be inserted here -->
                    </div>
                </div>
                
                <!-- Word puzzle container (IMPROVED) -->
                <div id="word-puzzle-container" class="bg-gray-900 rounded-xl p-6 shadow-lg mt-4 hidden flex-col flex-grow">
                    <h3 class="text-lg font-medium text-gold-300 mb-2">پاسخ شما:</h3>
                    <div id="word-answer-slot" class="bg-gray-800 rounded-lg p-3 mb-4 flex flex-wrap gap-2 min-h-[50px] gold-border items-center">
                        <!-- Selected words will appear here. Click to un-select -->
                    </div>
                    <h3 class="text-lg font-medium text-gold-300 mb-2">کلمات موجود:</h3>
                    <div id="word-options" class="flex flex-wrap gap-3 mt-2 justify-center">
                        <!-- Word options will be inserted here -->
                    </div>
                    <button id="check-word-puzzle" class="btn btn-gold w-full mt-6 py-3 rounded-lg text-lg font-bold">بررسی پاسخ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <!-- ... content is same as before, but add .btn class to button -->
    </div>
    
    <!-- Creator Mode Activated Modal -->
    <div id="creator-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <!-- ... content is same as before, but add .btn class to button -->
    </div>


    <script>
    // --- START OF REFACTORED SCRIPT ---

    // 1. EXPANDED PUZZLES ARRAY
    const puzzles = [
        // Original puzzles
        { type: 'multiple-choice', question: 'کدام حیوان بلندترین حیوان روی زمین است؟', options: ['زرافه', 'فیل', 'نهنگ', 'دایناسور'], correctAnswer: 'زرافه', hint: 'این حیوان گردن بسیار بلندی دارد.' },
        { type: 'multiple-choice', question: 'اگر ساعت 3:15 باشد، زاویه بین عقربه‌ها چند درجه است؟', options: ['7.5 درجه', '45 درجه', '90 درجه', '0 درجه'], correctAnswer: '7.5 درجه', hint: 'فرمول زاویه: |(30 * H) - (5.5 * M)|' },
        { type: 'word-puzzle', question: 'با کنار هم قرار دادن کلمات، نام یک شهر ایران را بسازید.', words: ['اص', 'فه', 'ان'], correctAnswer: 'اصفهان', hint: 'این شهر به نصف جهان معروف است.' },
        { type: 'multiple-choice', question: 'کدام گزینه ادامه منطقی این دنباله است؟ 2، 4، 8، 16، ...', options: ['24', '32', '64', '128'], correctAnswer: '32', hint: 'هر عدد دو برابر عدد قبلی است.' },
        { type: 'multiple-choice', question: 'کدام گزینه با بقیه متفاوت است؟', options: ['سیب', 'پرتقال', 'گوجه', 'موز'], correctAnswer: 'گوجه', hint: 'کدامیک از نظر گیاه‌شناسی در دسته متفاوتی قرار می‌گیرد؟' },
        { type: 'word-puzzle', question: 'با کنار هم قرار دادن کلمات، ضرب المثل معروف را بسازید.', words: ['عجله', 'کار', 'شیطان', 'است'], correctAnswer: 'عجلهکارشیطاناست', hint: 'این ضرب المثل درباره عواقب شتاب‌زدگی است.' },
        { type: 'multiple-choice', question: 'اگر امروز سه‌شنبه باشد، 100 روز بعد چه روزی خواهد بود؟', options: ['سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه'], correctAnswer: 'پنج‌شنبه', hint: '100 را بر 7 تقسیم کنید. باقیمانده 2 است. دو روز بعد از سه‌شنبه.' },
        // New Puzzles
        { type: 'multiple-choice', question: 'پایتخت استرالیا کدام شهر است؟', options: ['سیدنی', 'ملبورن', 'کانبرا', 'پرت'], correctAnswer: 'کانبرا', hint: 'برخلاف تصور عموم، سیدنی پایتخت نیست.' },
        { type: 'word-puzzle', question: 'با حروف "د ا ن ش م ن د" یک شغل دیگر بسازید.', words: ['ش', 'م', 'د', 'ا', 'ن', 'د', 'ن'], correctAnswer: 'دندانپزشک', hint: 'این کلمه در دسترس نیست. باید از حروف کلمه "دانشمند" استفاده کنید تا کلمه "دشمن" را بسازید.', correctAnswer: 'دشمن' },
        { type: 'multiple-choice', question: 'کدام سیاره به "سیاره سرخ" معروف است؟', options: ['زهره', 'مریخ', 'مشتری', 'زحل'], correctAnswer: 'مریخ', hint: 'این سیاره به دلیل وجود اکسید آهن در سطح آن، قرمز به نظر می‌رسد.' },
        { type: 'multiple-choice', question: 'اگر 5 گربه، 5 موش را در 5 دقیقه بگیرند، 100 گربه، 100 موش را در چند دقیقه می‌گیرند؟', options: ['100 دقیقه', '50 دقیقه', '10 دقیقه', '5 دقیقه'], correctAnswer: '5 دقیقه', hint: 'هر گربه برای گرفتن یک موش 5 دقیقه زمان نیاز دارد.' },
        { type: 'word-puzzle', question: 'نام کتاب حافظ را با کلمات زیر بسازید.', words: ['دیوان', 'حافظ'], correctAnswer: 'دیوانحافظ', hint: 'نام کامل کتاب چیست؟' },
        { type: 'multiple-choice', question: 'عدد بعدی در این دنباله چیست؟ ۱، ۱، ۲، ۳، ۵، ۸، ...', options: ['۱۱', '۱۲', '۱۳', '۱۴'], correctAnswer: '۱۳', hint: 'این دنباله فیبوناچی است. هر عدد حاصل جمع دو عدد قبلی است.' },
        { type: 'multiple-choice', question: '"من همیشه دروغ می‌گویم." این جمله راست است یا دروغ؟', options: ['راست', 'دروغ', 'هر دو', 'هیچکدام'], correctAnswer: 'هیچکدام', hint: 'این یک پارادوکس منطقی است. اگر راست باشد، پس گوینده دروغگوست که تناقض دارد. اگر دروغ باشد، پس گوینده راستگوست که باز هم تناقض دارد.' },
        { type: 'word-puzzle', question: 'پایتخت ایران را بسازید.', words: ['ته', 'ران'], correctAnswer: 'تهران', hint: 'برج میلاد در این شهر است.' },
        { type: 'multiple-choice', question: 'سبک‌ترین عنصر در جدول تناوبی کدام است؟', options: ['هلیوم', 'اکسیژن', 'هیدروژن', 'لیتیوم'], correctAnswer: 'هیدروژن', hint: 'این عنصر عدد اتمی ۱ را دارد.' },
    ];

    // 2. GAME STATE
    let currentLevel = 0;
    let playerData = {
        username: '', level: 0, coins: 0, cups: 0, isCreator: false
    };
    let selectedWordPieces = []; // For word puzzles

    // 3. CACHED DOM ELEMENTS
    const DOM = {
        screens: {
            splash: document.getElementById('splash-screen'),
            loading: document.getElementById('loading-screen'),
            registration: document.getElementById('registration-screen'),
            mainMenu: document.getElementById('main-menu'),
            game: document.getElementById('game-screen'),
        },
        modals: {
            result: document.getElementById('result-modal'),
            settings: document.getElementById('settings-modal'),
            creator: document.getElementById('creator-modal'),
        },
        buttons: {
            startGame: document.getElementById('start-game'),
            backToMenu: document.getElementById('back-to-menu'),
            result: document.getElementById('result-button'),
            settings: document.getElementById('settings-button'),
            closeSettings: document.getElementById('close-settings'),
            redeemCode: document.getElementById('redeem-code'),
            creatorOk: document.getElementById('creator-ok-button'),
            hint: document.getElementById('hint-button'),
            checkWordPuzzle: document.getElementById('check-word-puzzle'),
        },
        registrationForm: document.getElementById('registration-form'),
        usernameInput: document.getElementById('username'),
        loadingBar: document.getElementById('loading-bar'),
        loadingText: document.getElementById('loading-text'),
        profile: {
            name: document.getElementById('profile-name'),
            level: document.getElementById('player-level'),
            coins: document.getElementById('player-coins'),
            cups: document.getElementById('player-cups'),
            creatorBadge: document.getElementById('creator-badge'),
        },
        game: {
            level: document.getElementById('current-level'),
            question: document.getElementById('puzzle-question'),
            answerContainer: document.getElementById('answer-container'),
            answerOptions: document.getElementById('answer-options'),
            wordPuzzleContainer: document.getElementById('word-puzzle-container'),
            wordAnswerSlot: document.getElementById('word-answer-slot'),
            wordOptions: document.getElementById('word-options'),
        },
        result: {
            icon: document.getElementById('result-icon'),
            title: document.getElementById('result-title'),
            message: document.getElementById('result-message'),
            button: document.getElementById('result-button'),
        }
    };

    // 4. GAME LOGIC & FUNCTIONS

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        const savedPlayerData = localStorage.getItem('brainShowPlayerData');
        setTimeout(() => {
            showScreen('loading');
            if (savedPlayerData) {
                playerData = JSON.parse(savedPlayerData);
                startLoading();
            } else {
                showScreen('registration');
            }
        }, 2000);
        setupEventListeners();
    });

    function setupEventListeners() {
        DOM.registrationForm.addEventListener('submit', handleRegistration);
        DOM.buttons.startGame.addEventListener('click', () => {
            showScreen('game');
            loadLevel(playerData.level);
        });
        DOM.buttons.backToMenu.addEventListener('click', () => showScreen('mainMenu'));
        DOM.buttons.result.addEventListener('click', handleResultClick);
        DOM.buttons.settings.addEventListener('click', () => DOM.modals.settings.classList.remove('hidden'));
        DOM.buttons.closeSettings.addEventListener('click', () => DOM.modals.settings.classList.add('hidden'));
        DOM.buttons.redeemCode.addEventListener('click', handleRedeemCode);
        DOM.buttons.creatorOk.addEventListener('click', () => DOM.modals.creator.classList.add('hidden'));
        DOM.buttons.hint.addEventListener('click', showHint);
        DOM.buttons.checkWordPuzzle.addEventListener('click', checkWordPuzzleAnswer);
    }
    
    // --- Screen & UI Management ---
    function showScreen(screenName) {
        Object.values(DOM.screens).forEach(s => s.classList.add('hidden'));
        if (DOM.screens[screenName]) {
            DOM.screens[screenName].classList.remove('hidden');
        }
    }

    function startLoading() {
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.floor(Math.random() * 10) + 1;
            if (progress > 100) progress = 100;
            DOM.loadingBar.style.width = `${progress}%`;
            DOM.loadingText.textContent = `در حال بارگذاری... ${progress}%`;
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    showScreen('mainMenu');
                    updateMainMenuUI();
                }, 500);
            }
        }, 150);
    }

    function updateMainMenuUI() {
        DOM.profile.name.innerHTML = playerData.username;
        DOM.profile.level.textContent = playerData.level + 1;
        DOM.profile.coins.textContent = playerData.coins;
        DOM.profile.cups.textContent = playerData.cups;
        if (playerData.isCreator) {
            DOM.profile.creatorBadge.classList.remove('hidden');
            DOM.profile.name.innerHTML += ` <span class="text-xs bg-gradient-to-r from-red-500 to-yellow-500 text-white px-1 rounded">سازنده</span>`;
            DOM.buttons.hint.classList.remove('hidden');
        } else {
            DOM.buttons.hint.classList.add('hidden');
        }
    }

    // --- Player & Registration ---
    function handleRegistration(e) {
        e.preventDefault();
        const username = DOM.usernameInput.value.trim();
        if (username) {
            playerData = { username, level: 0, coins: 0, cups: 0, isCreator: false };
            savePlayerData();
            showScreen('loading');
            startLoading();
        }
    }
    
    function savePlayerData() {
        localStorage.setItem('brainShowPlayerData', JSON.stringify(playerData));
    }

    function updatePlayerProgress() {
        if (currentLevel >= playerData.level) {
            playerData.level = currentLevel + 1;
        }
        playerData.coins += 10;
        if ((currentLevel + 1) % 5 === 0) { // Get a cup every 5 levels
            playerData.cups += 1;
        }
        savePlayerData();
        updateMainMenuUI();
    }
    
    // --- Level Loading & Gameplay ---
    function loadLevel(levelIndex) {
        currentLevel = levelIndex;
        if (levelIndex >= puzzles.length) {
            showResult('تبریک!', 'شما تمام مراحل بازی را با موفقیت به پایان رساندید!', 'game-won');
            return;
        }
        
        const puzzle = puzzles[levelIndex];
        DOM.game.level.textContent = levelIndex + 1;
        DOM.game.question.textContent = puzzle.question;
        
        // Reset view
        DOM.game.answerContainer.classList.add('hidden');
        DOM.game.wordPuzzleContainer.classList.add('hidden');
        
        if (puzzle.type === 'multiple-choice') {
            loadMultipleChoicePuzzle(puzzle);
        } else if (puzzle.type === 'word-puzzle') {
            loadWordPuzzle(puzzle);
        }
    }

    function loadMultipleChoicePuzzle(puzzle) {
        DOM.game.answerOptions.innerHTML = '';
        DOM.game.answerContainer.classList.remove('hidden');
        const shuffledOptions = [...puzzle.options].sort(() => Math.random() - 0.5);
        shuffledOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'btn btn-dark py-3 px-4 rounded-lg transition-all';
            button.textContent = option;
            button.addEventListener('click', () => checkAnswer(option, puzzle.correctAnswer));
            DOM.game.answerOptions.appendChild(button);
        });
    }

    function loadWordPuzzle(puzzle) {
        DOM.game.wordPuzzleContainer.classList.remove('hidden');
        DOM.game.wordAnswerSlot.innerHTML = '';
        DOM.game.wordOptions.innerHTML = '';
        selectedWordPieces = [];

        const shuffledWords = [...puzzle.words].sort(() => Math.random() - 0.5);
        shuffledWords.forEach((word, index) => {
            const wordPiece = document.createElement('div');
            wordPiece.className = 'word-piece bg-gray-800 text-gold-300 py-2 px-4 rounded-lg gold-border';
            wordPiece.textContent = word;
            wordPiece.dataset.word = word;
            wordPiece.addEventListener('click', () => selectWord(wordPiece));
            DOM.game.wordOptions.appendChild(wordPiece);
        });
    }

    function selectWord(wordPiece) {
        wordPiece.classList.add('selected'); // Make it disappear from options
        selectedWordPieces.push(wordPiece);
        
        const answerPiece = wordPiece.cloneNode(true);
        answerPiece.classList.remove('selected');
        answerPiece.addEventListener('click', () => deselectWord(wordPiece, answerPiece));
        DOM.game.wordAnswerSlot.appendChild(answerPiece);
    }

    function deselectWord(originalPiece, answerPiece) {
        originalPiece.classList.remove('selected'); // Make it re-appear in options
        answerPiece.remove();
        selectedWordPieces = selectedWordPieces.filter(p => p !== originalPiece);
    }
    
    // --- Answer Checking ---
    function checkAnswer(selected, correct) {
        if (selected === correct) {
            showResult('آفرین!', 'پاسخ شما صحیح است!', 'success');
            updatePlayerProgress();
        } else {
            showResult('اشتباه!', 'پاسخ صحیح نیست. دوباره تلاش کنید.', 'error');
        }
    }

    function checkWordPuzzleAnswer() {
        const userAnswer = Array.from(DOM.game.wordAnswerSlot.children)
            .map(p => p.dataset.word)
            .join('');
        const correctAnswer = puzzles[currentLevel].correctAnswer;
        checkAnswer(userAnswer, correctAnswer);
    }
    
    // --- Modals and Results ---
    function handleResultClick() {
        DOM.modals.result.classList.add('hidden');
        if (DOM.result.button.dataset.type === 'success') {
            loadLevel(currentLevel + 1);
        } else if (DOM.result.button.dataset.type === 'error') {
            // Reset the level for another try
            loadLevel(currentLevel);
        } else if (DOM.result.button.dataset.type === 'game-won') {
            showScreen('mainMenu');
        }
    }

    function showResult(title, message, type) {
        DOM.modals.result.classList.remove('hidden');
        DOM.result.title.textContent = title;
        DOM.result.message.textContent = message;
        DOM.result.button.dataset.type = type;

        if (type === 'success' || type === 'game-won') {
            DOM.result.icon.innerHTML = `<svg class="w-8 h-8 text-gold-300" ...><path d="M5 13l4 4L19 7" /></svg>`; // Checkmark
            DOM.result.button.className = 'btn w-full py-3 ... btn-gold shine-effect';
            DOM.result.button.textContent = 'ادامه';
        } else { // error
            DOM.result.icon.innerHTML = `<svg class="w-8 h-8 text-red-500" ...><path d="M6 18L18 6M6 6l12 12" /></svg>`; // Cross
            DOM.result.button.className = 'btn w-full py-3 ... bg-gray-800 text-white border border-red-500';
            DOM.result.button.textContent = 'تلاش مجدد';
        }
    }
    
    // --- Creator & Hints ---
    function handleRedeemCode() {
        const code = document.getElementById('gift-code').value;
        if (code === 'a.av1401.d1401a.av.li.vd.ab.') {
            playerData.isCreator = true;
            playerData.coins = 9999;
            playerData.cups = 99;
            savePlayerData();
            updateMainMenuUI();
            DOM.modals.settings.classList.add('hidden');
            DOM.modals.creator.classList.remove('hidden');
        } else {
            alert('کد وارد شده معتبر نیست.');
        }
    }
    
    function showHint() {
        if (playerData.isCreator) {
            const hint = puzzles[currentLevel].hint;
            alert(`راهنمایی سازنده: ${hint}`);
        }
    }
    </script>
</body>
</html>